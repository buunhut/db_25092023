DROP DATABASE db_25092023 IF EXISTS;

CREATE DATABASE db_25092023;

USE DATABASE db_25092023;

CREATE TABLE users(
uId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
email VARCHAR(255) NOT NULL,
pass VARCHAR(255) NOT NULL,
fullName VARCHAR(100),
phone VARCHAR(20),
company VARCHAR(255),
address TEXT,
tax VARCHAR(20),
sta BOOLEAN DEFAULT TRUE
);

CREATE TABLE sanPham(
spId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
danhMuc VARCHAR(100) NOT NULL,
maSp VARCHAR(50) NOT NULL,
tenSp VARCHAR(255) NOT NULL,
dvt VARCHAR(20),
chiTiet TEXT,
baoHanh INT DEFAULT 0,
tonKho INT DEFAULT 0,
giaNhap DECIMAL(18, 0) NOT NULL,
giaBan DECIMAL(18, 0) NOT NULL,
hinhAnh JSON,
sta BOOLEAN DEFAULT TRUE,
uId INT NOT NULL,
FOREIGN KEY (uId) REFERENCES users(uId)
);

CREATE TABLE doiTac(
dtId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
maDt VARCHAR(100) NOT NULL,
tenDt VARCHAR(255) NOT NULL,
address TEXT,
tax VARCHAR(20),
phone VARCHAR(20),
lienHe VARCHAR(50),
loaiDt VARCHAR(3),
sta BOOLEAN DEFAULT TRUE,
uId INT NOT NULL,
FOREIGN KEY (uId) REFERENCES users(uId)
);

CREATE TABLE phieu(
pId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
ngay DATE NOT NULL,
loaiPhieu VARCHAR(3) NOT NULL,
soPhieu INT NOT NULL,
dtId INT NOT NULL,
tongTien DECIMAL(18, 0) DEFAULT 0,
thanhToan DECIMAL(18, 0) DEFAULT 0,
conNo DECIMAL(18, 0) DEFAULT 0,
ghiChu VARCHAR(100),
sta VARCHAR(20) DEFAULT 'mới tạo',
uId INT NOT NULL,
FOREIGN KEY (dtId) REFERENCES doiTac(dtId),
FOREIGN KEY (uId) REFERENCES users(uId)
);

CREATE TABLE bangChiTiet(
ctId INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
pId INT NOT NULL,
spId INT NOT NULL,
tenSp VARCHAR(255) NOT NULL,
soLuong INT NOT NULL,
donGia DECIMAL(18, 0) NOT NULL,
thanhTien DECIMAL(18, 0) NOT NULL,
sta VARCHAR(20) DEFAULT 'mới tạo',
uId INT NOT NULL,
FOREIGN KEY (pId) REFERENCES phieu(pId),
FOREIGN KEY (spId) REFERENCES sanPham(spId),
FOREIGN KEY (uId) REFERENCES users(uId)
);